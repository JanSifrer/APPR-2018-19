---
title: "Poročilo pri predmetu Analiza podatkov s programom R"
author: "Jan Šifrer"
output:
  html_document: default
  pdf_document:
    includes:
      in_header: lib/styles.sty
    latex_engine: xelatex
---

```{r setup, echo=FALSE, results='hide', message=FALSE, warning=FALSE}
# Če želimo nastaviti pisave v PDF-ju, odkomentiramo
# in sledimo navodilom v programu.
#source("fontconfig.r", encoding="UTF-8")

# Uvoz vseh potrebnih knjižnic
source("lib/libraries.r", encoding="UTF-8")
```

```{r rstudio, echo=FALSE, results='asis'}
# Izris povezave do RStudia na Binderju
source("lib/rstudio.r", encoding="UTF-8")
```

# Analiza preseljevanja Slovencev

Za projektno nalogo sem si izbral analizo presejevanja Slovencev. Vse potrebne podatke za to sem dobil na statističnem uradu Republike Slovenije (SI-STAT) oziroma na Eurostatu. Moj cilj je bil, da pokažem koliko Slovencev se seli, pri kakšni starosti se selijo in v katere države se največ Slovencev preseli. Prav tako pa sem se tudi odločil, da bom analiziral iz katerih držav se največ ljudi preseli v Slovenijo.

![](slike/selitev-druzina.jpg)

***

# Obdelava, uvoz in čiščenje podatkov

```{r uvoz, echo=FALSE, message=FALSE, warning=FALSE}
source("uvoz/uvoz.r", encoding="UTF-8")
```

Uvozil sem podatke o meddržavnih selitvah, podatke o tem iz katerih občin so se ljudje odseljevali, oziroma v katere občine priseljevali, osnovne lastnosti teh selivcev in nazadnje še podatke o bruto domačem proizvodu (BDP) Evropskih držav. Podatke sem uvažal v obliki CSV in enega v HTML, ter so razporejeni v 7 razpredelnicah v obliki *tidy data*.

1. `meddrzavne.selitve.osnovni` - osnovni podatki o meddržavnih selitvah
  - `vrsta` - spremenljivka: pove nam vrsto selitve, torej ali se je oseba izselila ali priselila v Slovenijo,
  - `starost` - spremenljivka: pove nam starost selivcev na 4 leta natančno. To pomeni da so starosti skupaj združene po 4 leta,
  - `spol` - spremenljivka: spol selivca,
  - `leto` - spremenljivka: pove nam v katerem letu nekaj opazujemo,
  - `stevilo` - meritev: Število selivcev pri določeni starosti (število).
  
2. `meddrzavne.selitve.drzavljanstvo` - podatki o tem iz katerih držav so se selili v/iz Slovenije.
  - `vrsta` -  spremenljivka: pove nam vrsto selitve,
  - `drzava` - spremenljivka: ime države (neurejen faktor),
  - `spol` - spremenljivka: spol selivca,
  - `leto` - spremenljivka: pove nam v katerem letu opazujemo,
  - `stevilo` - meritev: Število selivcev po državah (število).
  
3. `selitveno.gibanje` - podatki o tem v katere občine so se osebe priseljevale, oziroma iz katerih so se selile
  - `vrsta` - spremenljivka: pove nam vrsto selitve,
  - `spol` - spremenljivka: spol selivca,
  - `obcina` - spremenljivka: ime občine (neurejen faktor),
  - `leto` - spremenljivka: pove nam v katerem letu opazujemo,
  - `stevilo` - meritev: Število selivcev po občinah (število).
  
4. `odseljeni.prebivalci` - podatki o izseljenih osebah
  - `drzavljanstvo` - spremenljivka: pove nam ali je bil tuj državljan ali državljan RS,
  - `izobrazba` - spremenljivka: Stopnja izobrazbe (Osnovnošolska oz. manj, srednješolska, višješolska oz. visokošolska),
  - `drzava` - spremenljivka: kam se je preselil (neurejen faktor),
  - `spol` - spremenljivka: pove nam spol selivca,
  - `leto` - spremenljivka: pove nam v katerem letu opazujemo,
  - `stevilo` - meritev: Število izseljencev (število).
  
5. `priseljeni.prebivalci` - Podatki priseljenih osebah
  - `izobrazba` - spremenljivka: Stopnja izobrazbe (Osnovnošolska oz. manj, srednješolska, višješolska oz. visokošolska),
  - `drzava` - spremenljivka: iz katere države oseba prihaja (neurejen faktor),
  - `spol` - spremenljivka: spol priseljenca,
  - `leto` - spremenljivka: pove nam v katerem letu opazujemo,
  - `stevilo` - meritev: število priseljencev z določeno izobrazbo (število).
  
6. `bdp` - podatki o bruto domačem proizvodu
  - `Cas` - spremenljivka: pove nam v katerem letu merimo BDP,
  - `Drzava` - spremenljivka: pove nam za katero državo merimo BDP,
  - `BDP` - meritev: BDP (številka).
  
7. `obcine` - podatki o občinah
  - `obcina` - spremenljivka: ime občine (neurejen faktor),
  - `povrsina` - meritev: površina občine v km$^2$ (število),
  - `prebivalci` - meritev: prebivalstvo občine (število),
  - `gostota` - meritev: število prebivalcev na km$^2$ (število),
  - `naselja` - meritev: število naselij v občini (število),
  - `ustanovitev` - meritev: leto ustanovitve občine (število),
  - `pokrajina` - meritev: pokrajina, ki ji občina pripada (neurejen faktor),
  - `regija` - meritev: regija, ki ji občina pripada (neurejen faktor),
  - `odcepitev` - meritev: podatki o občinah, od katerih se je občina odcepila (besedilo).


**Opomba**: da bi razpredelnica `bdp` res bila v obliki *tidy data* bi moral odsraniti neznane vrednosti v stolpcu `BDP` (določene države za kakšno leto nimajo izmerjenega BDP).


Spodnji graf prikazuje število izseljenih in priseljenih ljudi po državah. Hkrati pa tudi prikazuje da je Slovenija glede odseljevanja na prvem mestu, glede izseljevanja pa na tretjem mestu.

```{r echo=FALSE, fig.align='center', fig.cap='Graf 1: Države selitev'}
ggplot(data=meddrzavne.selitve.drzavljanstvo %>% group_by(vrsta, drzava)
                           %>% summarise(Stevilo=sum(stevilo)), 
                           mapping = aes(x=reorder(drzava, Stevilo), y=Stevilo, fill=vrsta)) + 
  geom_bar(stat = 'identity', position = 'dodge') + xlab("Država") + ylab("Število") +
  ggtitle("Graf števila odseljenih in priseljenih po državah") + coord_flip()
```

***

# Analiza in vizualizacija podatkov

```{r vizualizacija, echo=FALSE, message=FALSE, warning=FALSE, results='hide'}
source("vizualizacija/moja-vizualizacija.r", encoding="UTF-8")
```
Kot sem že omenil, je Slovenija glede preseljevanja na samem vrhu. In postavi se logično vprašanje: Ali je to v redu, ali ne?
Po mojih podatkih je razvidno da izseljevanje iz Slovenije ni nič kaj koristno za našo državo, in sicer zato, ker se največ ljudi izseli med 20 in 34 letom starosti. To pomeni da se v naši državi izobražuje, nato pa zapusti našo državo, in začne svoje znanje prodajati v drugi državi.
```{r, echo=FALSE, fig.align='center', fig.cap='graf 2: Izseljeni po starosti'}
ggplot(data=meddrzavne.selitve.osnovni %>% 
                                              filter(vrsta=="Odseljeni v tujino") %>% 
                                       group_by(spol, starost, spol) %>% 
                                       summarise(Stevilo=sum(stevilo)), 
                                     mapping = aes(x=starost, y=Stevilo, fill=spol)) + 
                                       geom_bar(stat = 'identity', position = 'dodge') +
  xlab("Starost") + ylab("Število")+ ggtitle("Graf izseljenih Slovencev po letih") + coord_flip()
```

```{r, echo=FALSE, fig.align='center',  fig.cap='Graf 3: Izseljeni po izobrazbi'}
ggplot(data=odseljeni.prebivalci %>% group_by(drzava, izobrazba) %>% summarise(Stevilo=sum(stevilo)),
                                     aes(x = drzava, y = Stevilo, fill = izobrazba)) +
  geom_bar(stat = 'identity', position = 'dodge') +
  xlab("Država") + ylab("Število") +
  ggtitle("Odseljeni prebivalci glede na izobrazbo") +
  coord_flip()
```
***
Vidimo da se je iz Slovenije res izselilo veliko ljudi z višješolsko oz. visokošolsko izobrazbo, malo več je bilo tistih s srednješolsko izobrazbo, najmanj pa je ljudi z osnovnošolskih izobrazbo.
Ravno nasprotno pa velja za priseljence. V spodnjih dveh grafih lahko vidimo, da se je največ ljudi priselilo s srednješolsko izobrazbo, sledijo pa jim osebe z osnovnošolsko ali manjšo izobrazbo. Podobnost pa lahko vidimo pri starosti preseljevanja, za kar pa tudi obstaja logična razlaga - v teh letih ljudje ravno iščejo zaposlitev, in če v tuji državi najdeš boljšo plačo za podobno delo, se lažje sedaj preseliš, kot pa potem ko boš imel enkrat družino. Če se za hip vrnemo na Graf 1, lahko sklepamo, da nekakšno tako razmišljanje  velja predvsem v Bosni in Hercegovini. Kajti ravno ta država je prva v številu izseljenih ljudi, vsi pa tudi vemo da je življenjski standard  v BIH nekoliko nižji kot drugje v Evropi.

```{r, echo=FALSE, fig.align='center', fig.cap='Graf 4: Priseljeni po letih'}
ggplot(data=priseljeni.prebivalci %>% group_by(drzava, izobrazba) %>% summarise(Stevilo=sum(stevilo)),
       aes(x = drzava, y = Stevilo, fill = izobrazba)) +
  geom_bar(stat = 'identity', position = 'dodge') +
  xlab("Država") + ylab("Število") +
  ggtitle("Priseljeni prebivalci glede na izobrazbo") +
  coord_flip()
```

```{r, echo=FALSE, fig.align='center', fig.cap='Graf 5: Priseljeni po izobrazbi'}
ggplot(data=meddrzavne.selitve.osnovni %>% 
                                               filter(vrsta=="Priseljeni iz tujine") %>% 
                                                 group_by(spol, starost) %>% 
                                                 summarise(Stevilo=sum(stevilo)), 
                                               mapping = aes(x=starost, y=Stevilo, fill=spol)) + 
  geom_bar(stat = 'identity', position = 'dodge') +
  xlab("Starost") + ylab("Število")+ ggtitle("Graf priseljenih Slovencev po letih") + coord_flip()

```

*****************
Spodnji zemljevid prikazuje razliko med priseljenimi in izseljenimi osebami.

```{r, echo=FALSE, fig.align='center', fig.cap='Zemljevid 1: Selitveni prirast'}
ggplot() + geom_polygon(data=left_join(zemljevid, razlika.obcine,
                                       by=c("OB_UIME"="obcina")),
                        aes(x=long, y=lat, group=group,
                            fill=factor(round(razlika+0.05, 1)))) +
  ggtitle("Razlika priseljenih in odseljenih deljena s številom prebivalcev") +
  xlab("") + ylab("") +
  scale_fill_discrete(guide=guide_legend(title="Število"),
                      labels=. %>% { paste({parse_number(.) %>% { . - 0.1 }}, "-", .) })
```
***

```{r echo=FALSE, fig.align='center', fig.cap='Zemljevid povprečnega števila otrok v družini'}
# plot(graf_bdp)
```